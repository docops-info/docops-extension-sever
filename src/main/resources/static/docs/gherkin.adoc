include::_base.adoc[]
= DocOps Gherkin

reactions::[role=right]

include::shared/buttons.adoc[]

== Overview

The DocOps Gherkin visualization renders readable, attractive diagrams from Gherkin feature definitions.
It supports both plain-text Gherkin (Feature/Scenario/Steps) and a JSON specification for advanced
styling, layout, and status control. Use it to communicate behavior-driven specifications directly in your
AsciiDoc documentation.

== Features

* Accepts plain Gherkin text or JSON payloads
* Visualizes Feature, Scenarios, and Steps with distinct icons and colors
* Step and Scenario status indicators (PASSING, FAILING, PENDING, SKIPPED)
* Optional dark mode rendering
* Theme customization (colors, layout, typography) via JSON

== Quick Start (Plain Gherkin)

[source,asciidoc]
....
[docops,gherkin,controls=true]
----
Feature: User Authentication
  Scenario: Successful Login
    Given the user is on the login page
    When they enter valid credentials
    Then they should be redirected to dashboard
    And the login attempt should be logged

  Scenario: Failed Login
    Given the user is on the login page
    When they enter invalid credentials
    Then they should see an error message
    And they should remain on the login page
----
....

[docops,gherkin,controls=true]
----
Feature: User Authentication
  Scenario: Successful Login
    Given the user is on the login page
    When they enter valid credentials
    Then they should be redirected to dashboard
    And the login attempt should be logged

  Scenario: Failed Login
    Given the user is on the login page
    When they enter invalid credentials
    Then they should see an error message
    And they should remain on the login page
----

=== More Plain Gherkin Examples

These richer examples stay within the supported syntax (Feature/Scenario/Steps) but tell more interesting stories.

==== Shopping Cart Discounts

[source,asciidoc]
....
[docops,gherkin,controls=true]
----
Feature: Shopping Cart Discounts
  Scenario: Apply Coupon and Member Discount
    Given a logged-in shopper with items in the cart
    And they have a valid 10% coupon
    When they apply the coupon at checkout
    Then the subtotal should reflect a 10% discount
    And the member discount should be applied afterwards
    But the total should not go below $0.00

  Scenario: Expired Coupon Rejected
    Given a guest user on the checkout page
    When they enter an expired coupon code
    Then they should see an error explaining the coupon is expired
    And the cart total should remain unchanged
----
....

[docops,gherkin,controls=true]
----
Feature: Shopping Cart Discounts
  Scenario: Apply Coupon and Member Discount
    Given a logged-in shopper with items in the cart
    And they have a valid 10% coupon
    When they apply the coupon at checkout
    Then the subtotal should reflect a 10% discount
    And the member discount should be applied afterwards
    But the total should not go below $0.00

  Scenario: Expired Coupon Rejected
    Given a guest user on the checkout page
    When they enter an expired coupon code
    Then they should see an error explaining the coupon is expired
    And the cart total should remain unchanged
----

==== Service Resilience (Circuit Breaker)

[source,asciidoc]
....
[docops,gherkin,controls=true]
----
Feature: Circuit Breaker Behavior
  Scenario: Open on Consecutive Failures
    Given the downstream payment service is failing
    When three consecutive calls fail
    Then the circuit breaker should open
    And subsequent calls should be short-circuited

  Scenario: Half-Open Probe
    Given the circuit breaker is open for 60s
    When the cooldown elapses
    Then a single probe request should be allowed
    And if it succeeds the circuit should close
    But if it fails the circuit should stay open
----
....

[docops,gherkin,controls=true]
----
Feature: Circuit Breaker Behavior
  Scenario: Open on Consecutive Failures
    Given the downstream payment service is failing
    When three consecutive calls fail
    Then the circuit breaker should open
    And subsequent calls should be short-circuited

  Scenario: Half-Open Probe
    Given the circuit breaker is open for 60s
    When the cooldown elapses
    Then a single probe request should be allowed
    And if it succeeds the circuit should close
    But if it fails the circuit should stay open
----

==== Dark Mode Example

Render in dark theme using the useDark attribute.

[source,asciidoc]
....
[docops,gherkin,controls=true,useDark=true]
----
Feature: Search Suggestions
  Scenario: Show Suggestions While Typing
    Given a user is on the search page
    When they type the first three characters
    Then the top 5 matching suggestions should appear
    And selecting a suggestion should populate the input
----
....

[docops,gherkin,controls=true,useDark=true]
----
Feature: Search Suggestions
  Scenario: Show Suggestions While Typing
    Given a user is on the search page
    When they type the first three characters
    Then the top 5 matching suggestions should appear
    And selecting a suggestion should populate the input
----

== JSON Specification (Advanced)

You can fully control colors, layout, typography, and status using a JSON payload. This is useful when you
need to show step/scenario outcomes or adjust sizes.

[source,asciidoc]
....
[docops,gherkin]
----
{
  "feature": "User Authentication",
  "scenarios": [
    {
      "title": "Successful Login",
      "status": "PASSING",
      "steps": [
        { "type": "GIVEN", "text": "the user is on the login page", "status": "PASSING" },
        { "type": "WHEN",  "text": "they enter valid credentials",     "status": "PASSING" },
        { "type": "THEN",  "text": "they should be redirected to dashboard", "status": "PASSING" },
        { "type": "AND",   "text": "the login attempt should be logged", "status": "PASSING" }
      ]
    },
    {
      "title": "Failed Login",
      "status": "FAILING",
      "steps": [
        { "type": "GIVEN", "text": "the user is on the login page", "status": "PASSING" },
        { "type": "WHEN",  "text": "they enter invalid credentials", "status": "FAILING" },
        { "type": "THEN",  "text": "they should see an error message", "status": "PENDING" },
        { "type": "AND",   "text": "they should remain on the login page", "status": "SKIPPED" }
      ]
    }
  ],
  "theme": {
    "colors": {
      "feature": "#4361ee",
      "scenario": "#f8f9fa",
      "given": "#4361ee",
      "when": "#ff6b35",
      "then": "#06d6a0",
      "and": "#6c757d",
      "but": "#6c757d",
      "passing": "#28a745",
      "failing": "#dc3545",
      "pending": "#ffc107",
      "skipped": "#6c757d"
    },
    "layout": { "width": 600, "height": 420, "padding": 20, "scenarioSpacing": 30, "stepSpacing": 25 },
    "typography": { "featureSize": 18, "scenarioSize": 16, "stepSize": 12, "descriptionSize": 10, "fontFamily": "Arial, sans-serif" }
  }
}
----
....

[docops,gherkin]
----
{
  "feature": "User Authentication",
  "scenarios": [
    {
      "title": "Successful Login",
      "status": "PASSING",
      "steps": [
        { "type": "GIVEN", "text": "the user is on the login page", "status": "PASSING" },
        { "type": "WHEN",  "text": "they enter valid credentials",     "status": "PASSING" },
        { "type": "THEN",  "text": "they should be redirected to dashboard", "status": "PASSING" },
        { "type": "AND",   "text": "the login attempt should be logged", "status": "PASSING" }
      ]
    },
    {
      "title": "Failed Login",
      "status": "FAILING",
      "steps": [
        { "type": "GIVEN", "text": "the user is on the login page", "status": "PASSING" },
        { "type": "WHEN",  "text": "they enter invalid credentials", "status": "FAILING" },
        { "type": "THEN",  "text": "they should see an error message", "status": "PENDING" },
        { "type": "AND",   "text": "they should remain on the login page", "status": "SKIPPED" }
      ]
    }
  ],
  "theme": {
    "colors": {
      "feature": "#4361ee",
      "scenario": "#f8f9fa",
      "given": "#4361ee",
      "when": "#ff6b35",
      "then": "#06d6a0",
      "and": "#6c757d",
      "but": "#6c757d",
      "passing": "#28a745",
      "failing": "#dc3545",
      "pending": "#ffc107",
      "skipped": "#6c757d"
    },
    "layout": { "width": 600, "height": 420, "padding": 20, "scenarioSpacing": 30, "stepSpacing": 25 },
    "typography": { "featureSize": 18, "scenarioSize": 16, "stepSize": 12, "descriptionSize": 10, "fontFamily": "Arial, sans-serif" }
  }
}
----

=== Additional JSON Example

This example mixes statuses and applies a distinct theme.

[source,asciidoc]
....
[docops,gherkin,controls=true]
----
{
  "feature": "Continuous Integration Pipeline",
  "scenarios": [
    {
      "title": "Successful build and deploy",
      "status": "PASSING",
      "steps": [
        { "type": "GIVEN", "text": "code is pushed to main", "status": "PASSING" },
        { "type": "WHEN",  "text": "the build pipeline runs", "status": "PASSING" },
        { "type": "THEN",  "text": "artifacts are built and stored", "status": "PASSING" },
        { "type": "AND",   "text": "deployment to staging succeeds", "status": "PASSING" }
      ]
    },
    {
      "title": "Unit tests failing",
      "status": "FAILING",
      "steps": [
        { "type": "GIVEN", "text": "a merge request is opened", "status": "PASSING" },
        { "type": "WHEN",  "text": "unit tests execute", "status": "FAILING" },
        { "type": "THEN",  "text": "the pipeline should fail and block merge", "status": "FAILING" },
        { "type": "BUT",   "text": "static analysis should still report results", "status": "PENDING" }
      ]
    },
    {
      "title": "Lint warnings do not fail build",
      "status": "PENDING",
      "steps": [
        { "type": "GIVEN", "text": "linting is configured as non-blocking", "status": "PASSING" },
        { "type": "WHEN",  "text": "lint warnings are found", "status": "PENDING" },
        { "type": "THEN",  "text": "the pipeline should continue", "status": "PASSING" },
        { "type": "AND",   "text": "a report should be attached to the MR", "status": "SKIPPED" }
      ]
    }
  ],
  "theme": {
    "colors": {
      "feature": "#5e60ce",
      "scenario": "#f0f4f8",
      "given": "#3a86ff",
      "when": "#fb5607",
      "then": "#2ec4b6",
      "and": "#6c757d",
      "but": "#8338ec",
      "passing": "#2eb85c",
      "failing": "#e03131",
      "pending": "#f59f00",
      "skipped": "#868e96"
    },
    "layout": { "width": 720, "height": 460, "padding": 24, "scenarioSpacing": 34, "stepSpacing": 26 },
    "typography": { "featureSize": 20, "scenarioSize": 16, "stepSize": 12, "descriptionSize": 10, "fontFamily": "Inter, Arial, sans-serif" }
  }
}
----
....

[docops,gherkin,controls=true]
----
{
  "feature": "Continuous Integration Pipeline",
  "scenarios": [
    {
      "title": "Successful build and deploy",
      "status": "PASSING",
      "steps": [
        { "type": "GIVEN", "text": "code is pushed to main", "status": "PASSING" },
        { "type": "WHEN",  "text": "the build pipeline runs", "status": "PASSING" },
        { "type": "THEN",  "text": "artifacts are built and stored", "status": "PASSING" },
        { "type": "AND",   "text": "deployment to staging succeeds", "status": "PASSING" }
      ]
    },
    {
      "title": "Unit tests failing",
      "status": "FAILING",
      "steps": [
        { "type": "GIVEN", "text": "a merge request is opened", "status": "PASSING" },
        { "type": "WHEN",  "text": "unit tests execute", "status": "FAILING" },
        { "type": "THEN",  "text": "the pipeline should fail and block merge", "status": "FAILING" },
        { "type": "BUT",   "text": "static analysis should still report results", "status": "PENDING" }
      ]
    },
    {
      "title": "Lint warnings do not fail build",
      "status": "PENDING",
      "steps": [
        { "type": "GIVEN", "text": "linting is configured as non-blocking", "status": "PASSING" },
        { "type": "WHEN",  "text": "lint warnings are found", "status": "PENDING" },
        { "type": "THEN",  "text": "the pipeline should continue", "status": "PASSING" },
        { "type": "AND",   "text": "a report should be attached to the MR", "status": "SKIPPED" }
      ]
    }
  ],
  "theme": {
    "colors": {
      "feature": "#5e60ce",
      "scenario": "#f0f4f8",
      "given": "#3a86ff",
      "when": "#fb5607",
      "then": "#2ec4b6",
      "and": "#6c757d",
      "but": "#8338ec",
      "passing": "#2eb85c",
      "failing": "#e03131",
      "pending": "#f59f00",
      "skipped": "#868e96"
    },
    "layout": { "width": 720, "height": 460, "padding": 24, "scenarioSpacing": 34, "stepSpacing": 26 },
    "typography": { "featureSize": 20, "scenarioSize": 16, "stepSize": 12, "descriptionSize": 10, "fontFamily": "Inter, Arial, sans-serif" }
  }
}
----

== Supported Fields (JSON)

Main:

- feature: String (required)
- scenarios: Array<GherkinScenario> (required)
- theme: GherkinTheme (optional)

GherkinScenario:

- title: String (required)
- steps: Array<GherkinStep> (required)
- status: PASSING | FAILING | PENDING | SKIPPED (optional, default PASSING)

GherkinStep:

- type: GIVEN | WHEN | THEN | AND | BUT (required)
- text: String (required)
- status: PASSING | FAILING | PENDING | SKIPPED (optional, default PASSING)

Theme:

- colors: Customize feature/scenario/step and status colors
- layout: width, height, padding, scenarioSpacing, stepSpacing
- typography: featureSize, scenarioSize, stepSize, descriptionSize, fontFamily

== Block Attributes

The Gherkin block supports the standard DocOps attributes described in xref:docops.adoc[DocOps Block Processor]:

[cols="1,1,1,3"]
|===
|Attribute |Type |Default |Description

|controls |Boolean |false |Show the interactive viewer (zoom/copy/fullscreen)
|title    |String  |SVG Viewer |Viewer title (for controls)
|useDark  |Boolean |false |Render using the dark theme palette
|scale    |String  |1.0 |Scale factor sent to the server
|role     |String  |center |Alignment for the rendered block (left/center/right)
|===


[docops,gherkin]
----
Feature: Represents a specific functionality or feature of the system. It's a high-level description of what the system should do.
Scenario: A specific instance of the feature's behavior. It outlines a particular use case or test case.
Given: Describes the initial context or setup before the action. It sets the stage for the scenario.
When: Describes the action or event that triggers the behavior. It's the user action or system event.
Then: Describes the expected outcome or result after the action. It verifies the behavior.
And:Used to add more steps to the Given, When, or Then parts, making the scenario more detailed.
But: Similar to "And", but used to add an exception or negative condition.
----

[docops,gherkin]
----
Feature: User Login, As a user, I want to be able to log in to the system.

  Scenario: Successful Login
    Given I am on the login page
    When I enter a valid username and password
    Then I should be redirected to the homepage
    And I should see a welcome message

  Scenario: Invalid Login
    Given I am on the login page
    When I enter an invalid username and password
    Then I should see an error message

  Scenario Outline: Login with different users
    Given I am on the login page
    When I enter username  and password
    Then I should see the message
    Examples:
      | username | password | message |
      | user1 | pass1 | Welcome |
      | user2 | wrong_password | Invalid credentials |
----

== Notes

- Plain text parsing supports: Feature:, Scenario:, and step keywords Given/When/Then/And/But
- Plain text steps default to PASSING status; use JSON to specify statuses and theme overrides
- The same server endpoint used by other DocOps visuals is called under the hood: kind=gherkin



include::shared/buttons.adoc[]
